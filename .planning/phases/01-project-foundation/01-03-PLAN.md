---
phase: 01-project-foundation
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - fixtures/entities-response.json
  - fixtures/entities-response-page2.json
  - fixtures/metrics-cpu-response.json
  - fixtures/metrics-memory-response.json
  - fixtures/metrics-network-response.json
  - fixtures/README.md
autonomous: true
requirements:
  - DEV-01

must_haves:
  truths:
    - "A fixtures/ directory exists at the project root with realistic Dynatrace API JSON responses"
    - "Fixture data covers 2 namespaces (production, staging), all three workload types (DEPLOYMENT, STATEFUL_SET, DAEMON_SET)"
    - "At least one workload has null cpuRequest/memoryRequest to test the fallback path"
    - "At least one workload has null network metric values to test graceful degradation"
    - "A paginated entities response pair exists (first page has nextPageKey, second has no nextPageKey)"
    - "Fixture data can be imported directly in tests without generation at test time"
  artifacts:
    - path: "fixtures/entities-response.json"
      provides: "First page of workload entities across 2 namespaces"
      contains: "nextPageKey"
    - path: "fixtures/entities-response-page2.json"
      provides: "Second (final) page of workload entities — no nextPageKey"
    - path: "fixtures/metrics-cpu-response.json"
      provides: "CPU usage percentile metric timeseries for all fixture workloads"
    - path: "fixtures/metrics-memory-response.json"
      provides: "Memory usage percentile metric timeseries for all fixture workloads"
    - path: "fixtures/metrics-network-response.json"
      provides: "Network Rx bytes timeseries — includes null values for one workload to test graceful degradation"
      contains: "null"
    - path: "fixtures/README.md"
      provides: "Documents fixture structure, property name assumptions, and update instructions for Phase 3"
  key_links:
    - from: "fixtures/entities-response.json"
      to: "fixtures/metrics-cpu-response.json"
      via: "entityId matching — entity IDs in entities must appear as dimension values in metrics"
      pattern: "CLOUD_APPLICATION-"
    - from: "fixtures/README.md"
      to: ".planning/phases/01-project-foundation/01-RESEARCH.md"
      via: "assumption documentation"
      pattern: "Phase 3|cpuRequest|property names"
---

<objective>
Create the `fixtures/` directory with realistic Dynatrace v2 API JSON responses that represent a multi-namespace Kubernetes cluster. These fixtures enable all downstream phases (4, 5, 6, 7, 8) to develop and test without a live Dynatrace connection, satisfying DEV-01.

Purpose: Fixtures are the safety net for every phase that follows. Designing them now with edge cases (null resource requests, null network data, paginated responses, all workload types) means downstream phases can test edge-case code paths without hitting a live API.
Output: fixtures/ directory with 5 JSON files and a README.md documenting the fixture structure and assumptions.
</objective>

<execution_context>
@/Users/shubh/.claude/get-shit-done/workflows/execute-plan.md
@/Users/shubh/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/REQUIREMENTS.md
@.planning/phases/01-project-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create fixture JSON files for entities and metrics API responses</name>
  <files>fixtures/entities-response.json, fixtures/entities-response-page2.json, fixtures/metrics-cpu-response.json, fixtures/metrics-memory-response.json, fixtures/metrics-network-response.json</files>
  <action>
Create the `fixtures/` directory at the project root (/Users/shubh/Repos/Github_Shubham/ops-pod-optimization/fixtures/) and populate it with the following JSON files.

**Design requirements for all fixtures:**
- Entity IDs must be internally consistent: the same entity IDs that appear in entities-response.json must appear as dimension values in the metrics responses
- Use entity IDs in format `CLOUD_APPLICATION-{16 hex chars}`
- Use 7 workloads total across 2 pages and 2 namespaces
- The same set of entity IDs appears in all metric responses (CPU, memory, network)

**Workload inventory to use across both entity pages:**
```
ID suffix | displayName        | namespace   | workloadType  | cpuRequest | memoryRequest
0001      | api-gateway        | production  | DEPLOYMENT    | 250        | 536870912   (512Mi)
0002      | postgres           | production  | STATEFUL_SET  | 1000       | 2147483648  (2Gi)
0003      | log-shipper        | production  | DAEMON_SET    | 100        | 134217728   (128Mi)
0004      | auth-service       | production  | DEPLOYMENT    | 500        | 1073741824  (1Gi)  — cpuRequest: null (tests fallback)
0005      | worker             | staging     | DEPLOYMENT    | 200        | 268435456   (256Mi)
0006      | redis              | staging     | STATEFUL_SET  | 500        | 536870912   (512Mi)
0007      | metrics-exporter   | staging     | DAEMON_SET    | 50         | 67108864    (64Mi)
```

**fixtures/entities-response.json** — First page (4 workloads), includes nextPageKey:
```json
{
  "totalCount": 7,
  "pageSize": 4,
  "nextPageKey": "next-page-token-abc123",
  "entities": [
    {
      "entityId": "CLOUD_APPLICATION-AABBCC1122330001",
      "displayName": "api-gateway",
      "firstSeenTms": 1700000000000,
      "lastSeenTms": 1706000000000,
      "properties": {
        "kubernetesNamespace": "production",
        "workloadType": "DEPLOYMENT",
        "desiredReplicas": 5,
        "availableReplicas": 5,
        "cpuRequest": 250,
        "memoryRequest": 536870912
      }
    },
    {
      "entityId": "CLOUD_APPLICATION-AABBCC1122330002",
      "displayName": "postgres",
      "firstSeenTms": 1700000000000,
      "lastSeenTms": 1706000000000,
      "properties": {
        "kubernetesNamespace": "production",
        "workloadType": "STATEFUL_SET",
        "desiredReplicas": 3,
        "availableReplicas": 3,
        "cpuRequest": 1000,
        "memoryRequest": 2147483648
      }
    },
    {
      "entityId": "CLOUD_APPLICATION-AABBCC1122330003",
      "displayName": "log-shipper",
      "firstSeenTms": 1700000000000,
      "lastSeenTms": 1706000000000,
      "properties": {
        "kubernetesNamespace": "production",
        "workloadType": "DAEMON_SET",
        "desiredReplicas": 3,
        "availableReplicas": 3,
        "cpuRequest": 100,
        "memoryRequest": 134217728
      }
    },
    {
      "entityId": "CLOUD_APPLICATION-AABBCC1122330004",
      "displayName": "auth-service",
      "firstSeenTms": 1700000000000,
      "lastSeenTms": 1706000000000,
      "properties": {
        "kubernetesNamespace": "production",
        "workloadType": "DEPLOYMENT",
        "desiredReplicas": 3,
        "availableReplicas": 3,
        "cpuRequest": null,
        "memoryRequest": null
      }
    }
  ]
}
```

**fixtures/entities-response-page2.json** — Second page (3 workloads), NO nextPageKey:
```json
{
  "totalCount": 7,
  "pageSize": 4,
  "entities": [
    {
      "entityId": "CLOUD_APPLICATION-AABBCC1122330005",
      "displayName": "worker",
      "firstSeenTms": 1700000000000,
      "lastSeenTms": 1706000000000,
      "properties": {
        "kubernetesNamespace": "staging",
        "workloadType": "DEPLOYMENT",
        "desiredReplicas": 4,
        "availableReplicas": 4,
        "cpuRequest": 200,
        "memoryRequest": 268435456
      }
    },
    {
      "entityId": "CLOUD_APPLICATION-AABBCC1122330006",
      "displayName": "redis",
      "firstSeenTms": 1700000000000,
      "lastSeenTms": 1706000000000,
      "properties": {
        "kubernetesNamespace": "staging",
        "workloadType": "STATEFUL_SET",
        "desiredReplicas": 1,
        "availableReplicas": 1,
        "cpuRequest": 500,
        "memoryRequest": 536870912
      }
    },
    {
      "entityId": "CLOUD_APPLICATION-AABBCC1122330007",
      "displayName": "metrics-exporter",
      "firstSeenTms": 1700000000000,
      "lastSeenTms": 1706000000000,
      "properties": {
        "kubernetesNamespace": "staging",
        "workloadType": "DAEMON_SET",
        "desiredReplicas": 3,
        "availableReplicas": 3,
        "cpuRequest": 50,
        "memoryRequest": 67108864
      }
    }
  ]
}
```

**fixtures/metrics-cpu-response.json** — CPU p90 usage for all 7 workloads. Use `dimensionMap` with `dt.entity.cloud_application` key mapping to entity IDs. Include 3 timestamps in a recent window. Values are percentages (0-100). Make api-gateway (0001) use ~25% of its CPU request (250m) to represent an over-provisioned workload:
```json
{
  "resolution": "1h",
  "result": [
    {
      "metricId": "builtin:containers.cpu.usagePercent:percentile(90)",
      "data": [
        {
          "dimensionMap": { "dt.entity.cloud_application": "CLOUD_APPLICATION-AABBCC1122330001" },
          "timestamps": [1705708800000, 1705712400000, 1705716000000],
          "values": [14.2, 16.8, 13.9]
        },
        {
          "dimensionMap": { "dt.entity.cloud_application": "CLOUD_APPLICATION-AABBCC1122330002" },
          "timestamps": [1705708800000, 1705712400000, 1705716000000],
          "values": [72.1, 68.4, 74.3]
        },
        {
          "dimensionMap": { "dt.entity.cloud_application": "CLOUD_APPLICATION-AABBCC1122330003" },
          "timestamps": [1705708800000, 1705712400000, 1705716000000],
          "values": [8.3, 9.1, 7.7]
        },
        {
          "dimensionMap": { "dt.entity.cloud_application": "CLOUD_APPLICATION-AABBCC1122330004" },
          "timestamps": [1705708800000, 1705712400000, 1705716000000],
          "values": [45.6, 52.3, 48.9]
        },
        {
          "dimensionMap": { "dt.entity.cloud_application": "CLOUD_APPLICATION-AABBCC1122330005" },
          "timestamps": [1705708800000, 1705712400000, 1705716000000],
          "values": [22.1, 24.5, 21.8]
        },
        {
          "dimensionMap": { "dt.entity.cloud_application": "CLOUD_APPLICATION-AABBCC1122330006" },
          "timestamps": [1705708800000, 1705712400000, 1705716000000],
          "values": [31.4, 29.8, 33.2]
        },
        {
          "dimensionMap": { "dt.entity.cloud_application": "CLOUD_APPLICATION-AABBCC1122330007" },
          "timestamps": [1705708800000, 1705712400000, 1705716000000],
          "values": [5.2, 6.1, 4.9]
        }
      ]
    }
  ]
}
```

**fixtures/metrics-memory-response.json** — Memory p90 usage for all 7 workloads. Values are in bytes. Make auth-service (0004) have high memory usage relative to request for testing:
```json
{
  "resolution": "1h",
  "result": [
    {
      "metricId": "builtin:containers.memory.residentMemoryBytes:percentile(90)",
      "data": [
        {
          "dimensionMap": { "dt.entity.cloud_application": "CLOUD_APPLICATION-AABBCC1122330001" },
          "timestamps": [1705708800000, 1705712400000, 1705716000000],
          "values": [134217728, 141557760, 128974848]
        },
        {
          "dimensionMap": { "dt.entity.cloud_application": "CLOUD_APPLICATION-AABBCC1122330002" },
          "timestamps": [1705708800000, 1705712400000, 1705716000000],
          "values": [1610612736, 1677721600, 1543503872]
        },
        {
          "dimensionMap": { "dt.entity.cloud_application": "CLOUD_APPLICATION-AABBCC1122330003" },
          "timestamps": [1705708800000, 1705712400000, 1705716000000],
          "values": [62914560, 65011712, 60817408]
        },
        {
          "dimensionMap": { "dt.entity.cloud_application": "CLOUD_APPLICATION-AABBCC1122330004" },
          "timestamps": [1705708800000, 1705712400000, 1705716000000],
          "values": [966367641, 1006632960, 939524096]
        },
        {
          "dimensionMap": { "dt.entity.cloud_application": "CLOUD_APPLICATION-AABBCC1122330005" },
          "timestamps": [1705708800000, 1705712400000, 1705716000000],
          "values": [150994944, 157286400, 146800640]
        },
        {
          "dimensionMap": { "dt.entity.cloud_application": "CLOUD_APPLICATION-AABBCC1122330006" },
          "timestamps": [1705708800000, 1705712400000, 1705716000000],
          "values": [268435456, 281018368, 260046848]
        },
        {
          "dimensionMap": { "dt.entity.cloud_application": "CLOUD_APPLICATION-AABBCC1122330007" },
          "timestamps": [1705708800000, 1705712400000, 1705716000000],
          "values": [31457280, 33554432, 30408704]
        }
      ]
    }
  ]
}
```

**fixtures/metrics-network-response.json** — Network Rx bytes. Include null values for log-shipper (0003) and metrics-exporter (0007) to test graceful degradation — these workloads simulate pods where OneAgent network monitoring is unavailable:
```json
{
  "resolution": "1h",
  "result": [
    {
      "metricId": "builtin:containers.net.bytesRx:percentile(90)",
      "data": [
        {
          "dimensionMap": { "dt.entity.cloud_application": "CLOUD_APPLICATION-AABBCC1122330001" },
          "timestamps": [1705708800000, 1705712400000, 1705716000000],
          "values": [5242880, 6291456, 4718592]
        },
        {
          "dimensionMap": { "dt.entity.cloud_application": "CLOUD_APPLICATION-AABBCC1122330002" },
          "timestamps": [1705708800000, 1705712400000, 1705716000000],
          "values": [1048576, 1310720, 983040]
        },
        {
          "dimensionMap": { "dt.entity.cloud_application": "CLOUD_APPLICATION-AABBCC1122330003" },
          "timestamps": [1705708800000, 1705712400000, 1705716000000],
          "values": [null, null, null]
        },
        {
          "dimensionMap": { "dt.entity.cloud_application": "CLOUD_APPLICATION-AABBCC1122330004" },
          "timestamps": [1705708800000, 1705712400000, 1705716000000],
          "values": [2097152, 2621440, 1835008]
        },
        {
          "dimensionMap": { "dt.entity.cloud_application": "CLOUD_APPLICATION-AABBCC1122330005" },
          "timestamps": [1705708800000, 1705712400000, 1705716000000],
          "values": [3145728, 3670016, 2883584]
        },
        {
          "dimensionMap": { "dt.entity.cloud_application": "CLOUD_APPLICATION-AABBCC1122330006" },
          "timestamps": [1705708800000, 1705712400000, 1705716000000],
          "values": [524288, 655360, 491520]
        },
        {
          "dimensionMap": { "dt.entity.cloud_application": "CLOUD_APPLICATION-AABBCC1122330007" },
          "timestamps": [1705708800000, 1705712400000, 1705716000000],
          "values": [null, null, null]
        }
      ]
    }
  ]
}
```
  </action>
  <verify>
    <automated>cd /Users/shubh/Repos/Github_Shubham/ops-pod-optimization && node --input-type=module --eval "import { readFileSync } from 'fs'; const files = ['fixtures/entities-response.json','fixtures/entities-response-page2.json','fixtures/metrics-cpu-response.json','fixtures/metrics-memory-response.json','fixtures/metrics-network-response.json']; files.forEach(f => { const d = JSON.parse(readFileSync(f,'utf8')); console.log(f + ': OK'); }); const e1 = JSON.parse(readFileSync('fixtures/entities-response.json','utf8')); console.assert(e1.nextPageKey, 'entities page 1 must have nextPageKey'); console.assert(e1.entities.some(e => e.properties.cpuRequest === null), 'must have null cpuRequest'); const net = JSON.parse(readFileSync('fixtures/metrics-network-response.json','utf8')); console.assert(net.result[0].data.some(d => d.values.some(v => v === null)), 'network must have null values'); console.log('All fixture validations passed');"</automated>
    <manual>Confirm 5 JSON files exist in fixtures/ directory. Verify entities-response.json has nextPageKey and one entity with null cpuRequest. Verify metrics-network-response.json has null values in at least one data series.</manual>
  </verify>
  <done>All 5 fixture JSON files exist in fixtures/, all are valid JSON, entities-response.json has nextPageKey, auth-service has null cpuRequest/memoryRequest, and metrics-network-response.json has null values for 2 workloads.</done>
</task>

<task type="auto">
  <name>Task 2: Create fixtures/README.md documenting fixture structure and Phase 3 assumptions</name>
  <files>fixtures/README.md</files>
  <action>
Create `fixtures/README.md` at /Users/shubh/Repos/Github_Shubham/ops-pod-optimization/fixtures/README.md documenting:

1. **Purpose** — What these fixtures are for (DEV-01: local development and testing without a live Dynatrace connection)

2. **Workload inventory table** — Table of all 7 workloads with entity ID suffix, displayName, namespace, workloadType, cpuRequest, memoryRequest, and notable edge case role:
   - 0001 api-gateway: over-provisioned CPU case
   - 0002 postgres: StatefulSet (no replica reduction recommendations)
   - 0003 log-shipper: DaemonSet + null network data
   - 0004 auth-service: null cpuRequest/memoryRequest (fallback path testing)
   - 0005 worker: standard Deployment in staging
   - 0006 redis: StatefulSet in staging
   - 0007 metrics-exporter: DaemonSet + null network data

3. **File descriptions** — One paragraph per fixture file explaining what API endpoint it represents and what edge cases it covers

4. **Property name assumptions** — Explicit note that property names (`cpuRequest`, `memoryRequest`, `workloadType`, `desiredReplicas`, `kubernetesNamespace`) are based on ARCHITECTURE.md documentation and may need updating after Phase 3 empirical validation against the live Dynatrace Managed instance. Example:
   ```
   ## IMPORTANT: Phase 3 Property Name Validation Required

   The entity property names in these fixtures (cpuRequest, memoryRequest, workloadType,
   desiredReplicas, kubernetesNamespace) are based on ARCHITECTURE.md documentation.
   These names must be validated against the actual Dynatrace Managed instance during
   Phase 3. If the actual property names differ, update this fixture file and all tests
   that depend on it.
   ```

5. **How to use in tests** — Short code snippet showing the `readFileSync` + `JSON.parse` pattern with the `__dirname` ESM workaround (`fileURLToPath(import.meta.url)`)

6. **Entity ID reference** — List of all entity IDs for copy-paste use in test assertions
  </action>
  <verify>
    <automated>cd /Users/shubh/Repos/Github_Shubham/ops-pod-optimization && test -f fixtures/README.md && wc -l fixtures/README.md | awk '{if ($1 < 30) {print "README too short: " $1 " lines"; exit 1} else {print "README OK: " $1 " lines"}}'</automated>
    <manual>Read fixtures/README.md and confirm it mentions the Phase 3 property name validation requirement and includes all 7 workloads in the inventory.</manual>
  </verify>
  <done>fixtures/README.md exists with at least 30 lines, documents all 7 workloads, explains edge cases, and includes the Phase 3 property name validation warning.</done>
</task>

</tasks>

<verification>
```bash
cd /Users/shubh/Repos/Github_Shubham/ops-pod-optimization
# Verify all fixture files exist
ls fixtures/
# Verify JSON validity
for f in fixtures/*.json; do node -e "JSON.parse(require('fs').readFileSync('$f','utf8'))" && echo "$f: valid"; done
# Verify entity IDs are consistent across fixture files
grep -o "CLOUD_APPLICATION-[A-F0-9]*" fixtures/entities-response.json | sort
grep -o "CLOUD_APPLICATION-[A-F0-9]*" fixtures/metrics-cpu-response.json | sort
```
</verification>

<success_criteria>
1. `fixtures/` directory exists at project root with 5 JSON files and 1 README.md
2. All JSON files are valid (parseable)
3. `entities-response.json` has `nextPageKey` (pagination test)
4. `entities-response.json` has one entity with `cpuRequest: null` (fallback path test)
5. `metrics-network-response.json` has at least 2 data series with all-null values (graceful degradation test)
6. All entity IDs in entities fixtures appear in all metric fixtures (consistency)
7. `fixtures/README.md` documents Phase 3 property name validation requirement
8. Fixture data spans both `production` and `staging` namespaces with all three workload types (DEPLOYMENT, STATEFUL_SET, DAEMON_SET)
</success_criteria>

<output>
After completion, create `.planning/phases/01-project-foundation/01-03-SUMMARY.md` documenting:
- Confirmation that DEV-01 is satisfied
- List of all 7 workloads with their entity IDs (for reference in later phases)
- Edge cases covered by fixtures
- Property name assumptions that require Phase 3 validation
</output>
