---
phase: 01-project-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - config.example.yaml
autonomous: true
requirements:
  - CFG-05

must_haves:
  truths:
    - "config.example.yaml exists in the repository root with inline comments on every field"
    - "Every config field across all phases is documented — the file does not need to be updated in Phase 2 or later"
    - "Each field documents its type, default value, and valid values"
    - "The memory headroom minimum (1.30) and replica HA floor (2) are documented inline"
  artifacts:
    - path: "config.example.yaml"
      provides: "Annotated example configuration covering all config fields from CFG-01 through CFG-04"
      min_lines: 80
      contains: "memoryHeadroomMultiplier"
  key_links:
    - from: "config.example.yaml"
      to: ".planning/REQUIREMENTS.md"
      via: "field coverage"
      pattern: "apiToken|namespaces|timeWindow|percentile|cpuHeadroomMultiplier|memoryHeadroomMultiplier|outputPath"
---

<objective>
Create the annotated `config.example.yaml` file that satisfies CFG-05 — a fully documented sample configuration covering ALL config fields across ALL phases, with inline comments explaining each field's type, default, valid values, and constraints.

Purpose: CFG-05 requires the complete config documentation in Phase 1. Writing it with only Phase 1 fields forces a rewrite in Phase 2. Writing it now with forward knowledge of all config fields from REQUIREMENTS.md means it never needs to be touched again.
Output: `config.example.yaml` at project root with every config field from CFG-01 through CFG-04 documented.
</objective>

<execution_context>
@/Users/shubh/.claude/get-shit-done/workflows/execute-plan.md
@/Users/shubh/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/REQUIREMENTS.md
@.planning/phases/01-project-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create config.example.yaml with full annotated schema</name>
  <files>config.example.yaml</files>
  <action>
Create `config.example.yaml` in the project root at /Users/shubh/Repos/Github_Shubham/ops-pod-optimization/config.example.yaml.

The file must document ALL fields required by CFG-01 through CFG-04 so it does not need to be modified in later phases. Include every field with:
- A comment line above it explaining what it does
- Its type (string, integer, float, list)
- Its default value (if any)
- Valid values or range
- Any hard constraints (e.g., memory headroom minimum of 1.30 even if a lower value is set)

Use the exact content from RESEARCH.md Pattern 5 as the base, verifying it includes all these fields:

**Required fields (from CFG-01 through CFG-04):**
- `endpoint` — Dynatrace Managed base URL (CFG-01)
- `apiToken` — API token for auth; overridable by DYNATRACE_API_TOKEN env var (CFG-01, CFG-02)
- `namespaces` — list of namespace names to analyze (CFG-01)
- `timeWindow` — default analysis window e.g. "7d"; overridable via --window flag (CFG-01, CFG-03)
- `percentile` — baseline percentile, default 90 (CFG-04)
- `cpuHeadroomMultiplier` — float >= 1.0, default 1.10 (CFG-04)
- `memoryHeadroomMultiplier` — float >= 1.30 MINIMUM enforced; default 1.30 (CFG-04, MEM-03 constraint)
- `cpuOverProvisionedThreshold` — fraction of CPU request below which a pod is over-provisioned, default 0.6
- `cpuUnderProvisionedThreshold` — fraction of CPU request above which a pod is under-provisioned, default 0.9
- `memoryOverProvisionedThreshold` — same convention as CPU, default 0.6
- `memoryUnderProvisionedThreshold` — default 0.9
- `minReplicaFloor` — minimum replica floor for replica reduction recommendations, default 2 (ANAL-02 constraint: never below 2)
- `outputPath` — path for generated HTML report, default "./report.html"

**Important constraints to document inline:**
- `memoryHeadroomMultiplier`: "MINIMUM: 1.30 — even if you set a lower value, 30% headroom is enforced." (from MEM-03)
- `minReplicaFloor`: "Deployments will never be recommended to scale below this value." (from ANAL-02)
- `apiToken`: "Can be overridden by DYNATRACE_API_TOKEN environment variable (env var takes precedence)." (from CFG-02)
- `timeWindow`: "Can be overridden at runtime with --window flag." (from CFG-03)

Structure the file with clear section headers (Dynatrace Connection, Analysis Scope, Time Window, Metric Configuration, Recommendation Thresholds, Output) using YAML comment dividers.

The file header comment should read:
```yaml
# Ops Pod Optimization Tool — Example Configuration
# Copy this file to config.yaml and fill in your values.
# All fields are documented with their type, default value, and valid values.
```
  </action>
  <verify>
    <automated>cd /Users/shubh/Repos/Github_Shubham/ops-pod-optimization && node -e "const yaml = require('js-yaml'); const fs = require('fs'); try { yaml.load(fs.readFileSync('config.example.yaml','utf8')); console.log('YAML valid'); } catch(e) { console.error('YAML invalid:', e.message); process.exit(1); }" 2>/dev/null || node --input-type=module --eval "import { readFileSync } from 'fs'; const content = readFileSync('config.example.yaml', 'utf8'); const fields = ['endpoint','apiToken','namespaces','timeWindow','percentile','cpuHeadroomMultiplier','memoryHeadroomMultiplier','minReplicaFloor','outputPath']; fields.forEach(f => { if (!content.includes(f)) { console.error('Missing field: ' + f); process.exit(1); } }); console.log('All required fields present');"</automated>
    <manual>Open config.example.yaml and verify every field has a comment explaining its type, default, and valid values. Confirm `memoryHeadroomMultiplier` includes the 1.30 minimum constraint note.</manual>
  </verify>
  <done>config.example.yaml exists at project root, is valid YAML, contains all required config fields from CFG-01 through CFG-04, and every field has inline comments documenting type, default, and constraints.</done>
</task>

</tasks>

<verification>
```bash
cd /Users/shubh/Repos/Github_Shubham/ops-pod-optimization
# Verify file exists and is non-trivial
wc -l config.example.yaml
# Verify all required field keys are present
grep -E "^(endpoint|apiToken|namespaces|timeWindow|percentile|cpuHeadroomMultiplier|memoryHeadroomMultiplier|cpuOverProvisionedThreshold|minReplicaFloor|outputPath):" config.example.yaml
```
</verification>

<success_criteria>
1. `config.example.yaml` exists in the project root
2. The file is valid YAML (parseable by js-yaml)
3. All 13 config fields are present with their keys
4. Every field has at least one inline comment explaining its purpose and valid values
5. `memoryHeadroomMultiplier` comment explicitly states the 1.30 minimum enforcement
6. `apiToken` comment mentions DYNATRACE_API_TOKEN env var override
7. `timeWindow` comment mentions --window CLI override
</success_criteria>

<output>
After completion, create `.planning/phases/01-project-foundation/01-02-SUMMARY.md` documenting:
- Confirmation that CFG-05 is satisfied
- List of all config field keys present in the file
- Any fields added beyond the RESEARCH.md pattern and why
</output>
